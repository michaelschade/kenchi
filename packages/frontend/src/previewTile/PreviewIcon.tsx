import { css } from '@emotion/react';
import {
  faCogs,
  faFileInvoice,
  faLayerGroup,
  IconDefinition,
} from '@fortawesome/pro-solid-svg-icons';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';

import { KenchiTheme } from '@kenchi/ui/lib/Colors';
import Emoji from '@kenchi/ui/lib/Emoji';

import { BranchTypeEnum } from '../graphql/generated';
import toolConfig from '../tool/config';
import { isWorkflow, VersionedNodeTypename } from '../utils/versionedNode';

var faKenchiDraft: IconDefinition = {
  prefix: 'fas',
  iconName: 'file-invoice',
  icon: [
    384,
    512,
    [],
    'f570',
    'M377,105 L279.1,7 C274.6,2.5 268.5,6.88338275e-15 262.1,6.88338275e-15 L256,6.88338275e-15 L256,128 L384,128 L384,121.9 C384,115.6 381.5,109.5 377,105 Z M224,6.88338275e-15 L224,136 C224,149.2 234.8,160 248,160 L248,160 L384,160 L384,488 C384,501.3 373.3,512 360,512 L360,512 L24,512 C10.7,512 1.35213021e-14,501.3 1.35213021e-14,488 L1.35213021e-14,488 L1.35213021e-14,24 C1.35213021e-14,10.7 10.7,6.88338275e-15 24,6.88338275e-15 L24,6.88338275e-15 L224,6.88338275e-15 Z M31.095,256.16 C30.335,258.44 30.335,258.44 32.045,267.37 C31.475,303.47 31.475,303.47 34.515,328.74 C37.555,355.15 37.555,355.15 46.485,387.64 C47.055,396 47.055,396 46.865,397.52 C48.765,404.17 48.765,404.17 62.255,408.92 C73.275,412.91 73.275,412.91 82.015,412.91 C83.915,412.91 83.915,412.91 85.055,412.53 C88.665,411.39 88.665,411.39 90.375,403.22 C90.755,401.51 90.755,401.51 90.185,398.47 C89.805,395.62 89.805,395.62 90.185,393.91 C89.805,379.28 89.805,379.28 94.745,364.46 C99.875,350.78 99.875,350.78 105.195,337.1 C107.855,362.94 107.855,362.94 116.025,388.02 C116.405,399.42 116.405,399.42 116.595,399.8 C117.735,403.22 117.735,403.22 134.265,410.25 C150.225,417.47 150.225,417.47 153.265,416.9 C157.065,416.33 157.065,416.33 158.395,407.4 C158.585,406.26 158.585,406.26 158.015,403.98 C157.445,401.7 157.445,401.7 157.825,400.18 C157.065,390.68 157.065,390.68 166.945,345.84 C178.915,291.12 178.915,291.12 193.545,264.33 C191.835,259.01 191.835,259.01 181.765,254.45 C174.165,251.03 174.165,251.03 167.705,250.08 C159.725,248.94 159.725,248.94 157.635,258.44 C154.215,266.42 154.215,266.42 147.945,288.65 C139.775,316.58 139.775,316.58 134.645,342.8 C131.605,325.13 131.605,325.13 131.605,300.43 C131.605,290.36 131.605,290.36 132.175,276.87 C132.555,265.47 132.555,265.47 132.555,264.14 C132.365,261.67 132.365,261.67 119.255,255.305 C106.145,248.94 106.145,248.94 104.055,249.32 C100.635,249.89 100.635,249.89 98.355,252.74 C96.555,256.88 96.555,256.88 96.1192105,259.314737 L96.075,259.58 L69.475,342.99 C63.965,306.32 63.965,306.32 63.965,290.17 C63.965,282.76 63.965,282.76 64.725,274.02 C65.485,264.33 65.485,264.33 65.295,263.19 C64.535,259.77 64.535,259.77 53.705,254.07 C42.875,248.37 42.875,248.37 37.935,248.18 C33.565,247.99 33.565,247.99 31.095,256.16 Z M214.875,250.46 C208.225,251.98 208.225,251.98 207.845,256.54 C207.845,257.68 207.845,257.68 208.51,258.915 C209.101111,260.012778 209.101111,260.012778 209.16679,261.035494 L209.175,261.29 L209.175,395.24 C209.175,397.52 209.175,397.52 208.415,398.47 C207.655,399.42 207.655,399.42 207.655,400.18 C207.655,403.22 207.655,403.22 211.835,406.83 C213.735,408.54 213.735,408.54 225.895,411.58 C237.485,414.43 237.485,414.43 239.195,414.05 C243.755,413.1 243.755,413.1 243.755,400.94 C243.755,399.8 243.755,399.8 242.615,397.995 C241.562692,396.328846 241.562692,396.328846 241.481746,394.257959 L241.475,393.91 L241.475,277.25 C242.615,269.27 242.615,269.27 243.755,265.47 C243.945,264.9 243.945,264.9 244.8,262.62 C245.655,260.34 245.655,260.34 245.655,259.01 C245.655,254.83 245.655,254.83 237.295,252.55 C231.785,251.03 231.785,251.03 223.615,250.46 C216.965,250.08 216.965,250.08 214.875,250.46 Z M316.955,248.75 C312.965,248.75 312.965,248.75 304.13,251.98 C295.295,255.21 295.295,255.21 289.595,255.02 C285.605,254.83 285.605,254.83 278.86,252.645 C272.115,250.46 272.115,250.46 271.165,250.46 C265.465,250.46 265.465,250.46 264.325,259.58 C264.135,260.91 264.135,260.91 265.465,263.95 C266.725,266.83 266.725,266.83 266.791316,268.004737 L266.795,268.13 L266.795,385.55 C266.795,387.83 266.795,387.83 265.465,391.82 C263.755,397.14 263.755,397.14 265.465,399.8 C268.315,403.98 268.315,403.98 280.285,409.3 C291.685,414.43 291.685,414.43 295.105,414.05 C298.525,413.67 298.525,413.67 300.33,409.205 C302.135,404.74 302.135,404.74 301.755,403.03 C301.375,401.32 301.375,401.32 300.045,396.76 C299.168077,393.778462 299.168077,393.778462 299.100621,391.444497 L299.095,391.06 L299.095,358.76 C302.705,361.61 302.705,361.61 306.41,364.555 C310.115,367.5 310.115,367.5 313.155,367.5 C328.735,367.5 328.735,367.5 343.745,338.24 C357.235,312.02 357.235,312.02 357.235,294.92 C357.235,271.36 357.235,271.36 338.995,261.67 C336.335,260.34 336.335,260.34 330.635,255.02 C325.885,250.46 325.885,250.46 321.515,249.32 C319.235,248.75 319.235,248.75 316.955,248.75 Z M323.225,276.3 C326.835,276.3 326.835,276.3 326.835,282.95 C326.835,295.68 326.835,295.68 318.475,313.92 C309.355,334.06 309.355,334.06 299.095,337.29 L299.095,291.5 C303.275,285.8 303.275,285.8 311.065,281.05 C318.855,276.3 318.855,276.3 323.225,276.3 Z',
  ],
};

const emojiStyle = css`
  display: inline-block;
  margin-top: 2px;
`;

const workflowStyle = ({ colors }: KenchiTheme) => css`
  display: inline-block;
  margin-top: 3px;
  color: ${colors.gray[8]};
  transform: scale(1.2);
`;

const collectionIconStyle = ({ colors }: KenchiTheme) => css`
  display: inline-block;
  margin-top: 3px;
  color: ${colors.gray[8]};
`;

const toolStyle = ({ colors }: KenchiTheme) => css`
  display: inline-block;
  position: relative;
  background-color: ${colors.fixed.gray[11]};
  border-radius: 3px;
  height: 20px;
  width: 20px;

  svg {
    position: absolute;
    transform: translateY(-50%) translateX(-50%);
    top: 50%;
    left: 50%;
    color: ${colors.fixed.white};
    height: 11px;
  }

  svg.tool-icon-gmailaction {
    margin-left: 1px;
  }
`;

type VersionedNodeItem = {
  __typename: VersionedNodeTypename;
  component?: string;
  branchType: BranchTypeEnum;
  icon: string | null;
};

type CollectionItem = {
  __typename: 'Collection';
  icon: string | null;
};

type Props = {
  item: VersionedNodeItem | CollectionItem;
};

export default function PreviewIcon({ item }: Props) {
  if (item.icon) {
    return <Emoji css={emojiStyle} emoji={item.icon} />;
  }
  if (item.__typename === 'Collection') {
    return (
      <FontAwesomeIcon
        css={collectionIconStyle}
        icon={faLayerGroup}
        size="sm"
      />
    );
  } else if (isWorkflow(item)) {
    let icon;
    if (item.branchType === BranchTypeEnum.draft) {
      icon = faKenchiDraft;
    } else {
      icon = faFileInvoice;
    }
    return <FontAwesomeIcon css={workflowStyle} icon={icon} size="sm" />;
  } else {
    if (!item.component) {
      throw new Error('Got item without a component');
    }
    let icon = toolConfig[item.component].getIcon();
    let name = item.component.toLowerCase();
    if (item.branchType === BranchTypeEnum.draft) {
      icon = faCogs;
      name = 'draft';
    }
    return (
      <div css={toolStyle}>
        <FontAwesomeIcon
          icon={icon}
          size="sm"
          className={`tool-icon-${name}`}
        />
      </div>
    );
  }
}
